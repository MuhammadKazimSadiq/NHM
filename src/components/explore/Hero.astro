---
import { Image } from "astro:assets";
import heroImg from "/src/images/cities/hero.jpg";
---

<header class="relative min-h-[95vh] overflow-hidden text-white">
  <!-- Parallax wrapper -->
  <div id="cities-hero-parallax" class="absolute inset-0 will-change-transform">
    
    <!-- Mobile image -->
    <div class="block md:hidden absolute inset-0">
      <Image
        src={heroImg}
        alt="Explore cities of Iran"
        priority
        sizes="100vw"
        class="h-[120%] w-full object-cover"
      />
    </div>

    <!-- Desktop video -->
    <div class="hidden md:block absolute inset-0">
      <video
        src="/videos/explore.mp4"
        class="h-[120%] w-full object-cover"
        autoplay
        muted
        loop
        playsinline
        preload="none"
        poster={heroImg.src}
      ></video>
    </div>
    
  </div>

  <!-- Content -->
  <div class="relative flex min-h-[95vh] items-end justify-start px-12 py-16 max-[520px]:px-5 max-[520px]:py-12 z-10">
    <h1 class="font-heading font-bold leading-[1.6] text-hero-heading drop-shadow-[0_12px_32px_rgba(0,0,0,0.85)] lg:ml-16 text-left fade-in slow">
      Explore Iran to its fullest
    </h1>
  </div>
</header>

<script>
(() => {
  const parallax = document.getElementById("cities-hero-parallax");
  if (!parallax) return;

  // Respect reduced motion
  if (window.matchMedia("(prefers-reduced-motion: reduce)").matches) return;

  let latestScroll = 0;
  let ticking = false;

  // Determine mobile/desktop
  const isMobile = window.matchMedia("(max-width: 768px)").matches;

  const strength = isMobile ? 0.15 : 0.45;
  const fadeDistance = isMobile ? 800 : 450;

  function update() {
    const translateY = latestScroll * strength;
    parallax.style.transform = `translateY(${translateY}px)`;

    // Only fade on desktop
    if (!isMobile) {
      const opacity = Math.max(0.65, 1 - latestScroll / fadeDistance);
      parallax.style.opacity = opacity.toString();
    }

    ticking = false;
  }

  window.addEventListener("scroll", () => {
    latestScroll = window.scrollY;
    if (!ticking) {
      requestAnimationFrame(update);
      ticking = true;
    }
  });
})();
</script>
