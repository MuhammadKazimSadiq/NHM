---
import { Image } from "astro:assets";
import heroImg from "/src/images/services/hero.jpg";
---

<section class="relative h-screen overflow-hidden text-white">
  <!-- Parallax image -->
  <div
    id="services-parallax"
    class="absolute inset-0 will-change-transform"
  >
    <Image
      src={heroImg}
      alt="NHM Travels services hero"
      priority
      sizes="100vw"
      class="hero-image h-[120%] w-full object-cover"
    />
  </div>

  <!-- Gradient overlay -->
  <!-- <div
    class="absolute inset-0 bg-[linear-gradient(180deg,rgba(0,0,0,0.55),rgba(0,0,0,0.45))]"
  ></div> -->

  <!-- Content -->
  <div class="relative z-10 flex h-full flex-col justify-end p-5 gap-y-8">
    <h1 class="font-heading font-bold leading-[1.4] text-heading-xl drop-shadow-[0_20px_48px_rgba(0,0,0,1)] lg:ml-16 w-full lg:w-2/3 fade-in slow">
      Answer the call, leave everything behind.
    </h1>

    <div class="flex justify-start lg:justify-end">
      <a
        href="#"
        class="
          mr-12 mb-12 inline-block rounded-full
          bg-[#0dbdad] px-12 py-4
          font-light text-white text-lg
          transition
          hover:-translate-y-0.5
          hover:brightness-90
          fly-left
        "
      >
        BOOK NOW â†’
      </a>
    </div>
  </div>
</section>

<style>
.hero-image {
  transition: opacity 0.25s linear;
}
</style>

<script>
(() => {
  const parallax = document.getElementById(
    "services-parallax"
  ) as HTMLDivElement | null;

  if (!parallax) return;

  // Disable on mobile
  if (window.matchMedia("(max-width: 768px)").matches) return;

  // Respect reduced motion
  if (window.matchMedia("(prefers-reduced-motion: reduce)").matches) return;

  let latestScroll = 0;
  let ticking = false;

  const strength = 0.5;      // ðŸ”¥ strong parallax
  const fadeDistance = 500;  // fade range

  function update() {
    if (!parallax) return;
    const translateY = latestScroll * strength;

    // Fade from 1 â†’ 0.6
    const opacity = Math.max(
      0.6,
      1 - latestScroll / fadeDistance
    );

    parallax.style.transform = `translateY(${translateY}px)`;
    parallax.style.opacity = opacity.toString();

    ticking = false;
  }

  window.addEventListener("scroll", () => {
    latestScroll = window.scrollY;

    if (!ticking) {
      requestAnimationFrame(update);
      ticking = true;
    }
  });
})();
</script>
